<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>T·∫•t c·∫£ h·ªì s∆°</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .container {
            max-width: none;
            width: 100%;
        }


        .table {
            width: 100%;              /* Ho·∫∑c d√πng gi√° tr·ªã l·ªõn h∆°n n·∫øu trong container nh·ªè */
            table-layout: fixed;      /* B·∫Øt bu·ªôc ƒë·ªÉ width c·ªôt ƒë∆∞·ª£c t√¥n tr·ªçng */
            border-collapse: collapse;
        }

        th, td {
            text-align: center;
            vertical-align: middle;
            font-size: 14px;
            padding: 6px 8px;
            border: 1px solid #ddd;
        }

        .table th {
            background-color: #ffe699;
            white-space: wrap;
        }

        .table td {
            background-color: #fdfdfd;
        }

        /* C·ªôt c·∫ßn wrap: GHI CH√ö v√† TR·ªû NG·∫†I */
        .table th.col-ghi-chu,
        .table td.col-ghi-chu,
        .table th.col-tro-ngai,
        .table td.col-tro-ngai {
            width: 200px;
            white-space: normal;
            word-break: break-word;
        }

        /* C√°c c·ªôt m√£/ƒë·ªëi t∆∞·ª£ng nh∆∞ DB/HD c≈©/m·ªõi: gi·ªØ nguy√™n width nh·ªè */
        .table th.col-db-cu,
        .table td.col-db-cu,
        .table th.col-hd-cu,
        .table td.col-hd-cu,
        .table th.col-db-moi,
        .table td.col-db-moi,
        .table th.col-hd-moi,
        .table td.col-hd-moi {
            width: 100px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .floating-menu {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9999;
            background: #fff8dc;
            padding: 6px;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-shadow: 2px 2px 10px rgba(0,0,0,0.2);
            cursor: move;
            width: 120px;
            text-align: center;

            /* Th√™m c√°c d√≤ng sau ƒë·ªÉ kh·∫Øc ph·ª•c d∆∞ chi·ªÅu cao */
            display: flex;
            flex-direction: column;
            align-items: center;
            max-height: fit-content;
        }

        .menu-options button {
            font-size: 13px;
        }

        #toggle-menu {
            width: 100%;
        }

        .pagination-container {
          margin-top: 20px;
        }

        .pagination-link {
          display: inline-block;
          padding: 8px 14px;
          margin: 0 4px;
          text-decoration: none;
          background-color: #f0f0f0;
          border: 1px solid #ccc;
          border-radius: 4px;
          color: #333;
          font-weight: bold;
          transition: background-color 0.3s ease;
        }

        .pagination-link:hover {
          background-color: #007bff;
          color: white;
          border-color: #007bff;
        }

        .pagination-current {
          display: inline-block;
          margin: 0 8px;
          font-weight: bold;
          color: #555;
        }

    </style>

</head>
<body>
<div class="container-fluid mt-4">
    <h3 class="text-center mb-4">DANH S√ÅCH H·ªí S∆† G·∫ÆN M·ªöI</h3>
    <div style="overflow-x: auto;">
        <div class="pagination-container">
          {% if current_page > 1 %}
            <a href="?page=1" class="pagination-link">Trang ƒë·∫ßu</a>
            <a href="?page={{ current_page|add:"-1" }}" class="pagination-link">Trang tr∆∞·ªõc</a>
          {% endif %}

          <span class="pagination-current">Trang {{ current_page }} / {{ total_pages }}</span>

          {% if current_page < total_pages %}
            <a href="?page={{ current_page|add:"1" }}" class="pagination-link">Trang sau</a>
            <a href="?page={{ total_pages }}" class="pagination-link">Trang cu·ªëi</a>
          {% endif %}
        </div>
        <table class="table table-bordered table-hover table-sm align-middle">
            <thead class="table-warning">
                <tr>
                    <th>STT</th>
                    <th>B·∫¢NG K√ä ƒê·ª¢T G√ÅN</th>
                    <th>ƒê·ª¢T NH·∫¨P</th>
                    <th>S·ªê H·ªí S∆†</th>
                    <th class="col-db-cu">DB C≈®</th>
                    <th class="col-hd-cu">HD C≈®</th>
                    <th class="col-db-moi">DB M·ªöI</th>
                    <th class="col-hd-moi">HD M·ªöI</th>
                    <th>ƒê·ª¢T</th>
                    <th>GB</th>
                    <th>B√ô ƒêM</th>
                    <th>HI·ªÜU L·ª∞C</th>
                    <th>M√É H·ª¢P ƒê·ªíNG</th>
                    <th>DS L∆ØU</th>
                    <th class="col-ghi-chu">GHI CH√ö</th>
                    <th class="col-tro-ngai">TR·ªû NG·∫†I</th>
                    <th>QU·∫¨N</th>
                    <th>L·∫¶N NH·∫¨P</th>
                </tr>
            </thead>
            <tbody>
                {% for index, ho_so in ho_sos %}
                <tr>
                    <td>{{ index }}</td>
                    <td>{{ ho_so.bang_ke_dot_gan }}</td>
                    <td>{{ ho_so.dot_nhap }}</td>
                    <td>{{ ho_so.so_ho_so }}</td>
                    <td class="col-db-cu">{{ ho_so.db_cu|default_if_none:'-' }}</td>
                    <td class="col-hd-cu">{{ ho_so.hd_cu|default_if_none:'-' }}</td>
                    <td class="col-db-moi" style="color: red;">{{ ho_so.db_moi|default_if_none:'-' }}</td>
                    <td class="col-hd-moi" style="color: red;">{{ ho_so.hd_moi|default_if_none:'-' }}</td>
                    <td>{{ ho_so.dot|default_if_none:'' }}</td>
                    <td {% if ho_so.gb != 11 %}style="color: red;"{% endif %}>{{ ho_so.gb }}</td>
                    <td {% if ho_so.bu_dm != "0" %}style="color: red;"{% endif %}>{{ ho_so.bu_dm }}</td>
                    <td>{{ ho_so.hieu_luc|default_if_none:'' }}</td>
                    <td>{{ ho_so.ma_hd|default_if_none:'-' }}</td>
                    <td>{{ ho_so.ds_luu|default_if_none:'' }}</td>
                    <td class="col-ghi-chu">{{ ho_so.ghi_chu|default_if_none:'' }}</td>
                    <td class="col-tro-ngai">{{ ho_so.tro_ngai|default_if_none:'' }}</td>
                    <td>{{ ho_so.quan }}</td>
                    <td>{{ ho_so.lan_nhap|default_if_none:'' }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
<!-- Floating Menu Button -->
<div id="floating-menu" class="floating-menu">
    <button id="toggle-menu" class="btn btn-warning btn-sm">‚ò∞</button>
    <div id="menu-options" class="menu-options d-none">
        <button class="btn btn-secondary btn-sm w-100 my-1" onclick="window.location.href='/'">üè† Trang ch·ªß</button>
        <a href="{% url 'them_ho_so' %}" class="btn btn-success btn-sm w-100 my-1">‚ûï Th√™m</a>
        <button onclick="nhapVaChuyenHuong('{% url 'sua_ho_so' %}', 's·ª≠a')" class="btn btn-primary btn-sm w-100 my-1">‚úèÔ∏è S·ª≠a</button>
        <button onclick="nhapVaChuyenHuong('{% url 'xoa_ho_so' %}', 'x√≥a')" class="btn btn-danger btn-sm w-100 my-1">üóëÔ∏è X√≥a</button>
        <button id="search-toggle" class="btn btn-info btn-sm w-100 my-1">üîç T√¨m ki·∫øm</button>
        <!-- ‚úÖ L·ª±a ch·ªçn lo·∫°i t√¨m -->
        <div id="search-options" class="d-none mt-2">
            <select id="search-field" class="form-select form-select-sm my-1">
                <option value="">-- Ch·ªçn tr∆∞·ªùng c·∫ßn t√¨m --</option>
                <option value="bang_ke_dot_gan">B·∫£ng k√™ ƒë·ª£t g·∫Øn</option>
                <option value="dot_nhap">ƒê·ª£t nh·∫≠p</option>
                <option value="so_ho_so">S·ªë h·ªì s∆°</option>
                <option value="danh_ba">Danh b·∫° (DB c≈©/m·ªõi)</option>
                <option value="hop_dong">H·ª£p ƒë·ªìng (HD c≈©/m·ªõi)</option>
                <option value="dot">ƒê·ª£t</option>
                <option value="gb">Gi√° Bi·ªÉu</option>
                <option value="bu_dm">B√π ƒê·ªãnh M·ª©c</option>
                <option value="hieu_luc">Hi·ªáu l·ª±c</option>
                <option value="ma_hop_dong">M√£ h·ª£p ƒë·ªìng</option>
                <option value="ds_luu">DS l∆∞u</option>
                <option value="ghi_chu">Ghi Ch√∫</option>
                <option value="tro_ngai">Tr·ªü Ng·∫°i</option>
                <option value="quan">Qu·∫≠n</option>
                <option value="lan_nhap">L·∫ßn Nh·∫≠p</option>
            </select>

            <input id="search-value" type="text" class="form-control form-control-sm my-1" placeholder="Nh·∫≠p gi√° tr·ªã c·∫ßn t√¨m...">
            <button class="btn btn-sm btn-success w-100" onclick="submitSearch()">üîé T√¨m</button>
        </div>
        <button onclick="window.location.href='{% url 'xuat_excel' %}'" class="btn btn-outline-success btn-sm w-100 my-1">üì• Xu·∫•t Excel</button>
    </div>
</div>
<script>
    // Toggle hi·ªÉn th·ªã menu
    document.getElementById('toggle-menu').addEventListener('click', function () {
        const menu = document.getElementById('menu-options');
        menu.classList.toggle('d-none');
    });

    // K√©o th·∫£ menu
    (function () {
        const menu = document.getElementById('floating-menu');
        const dragHandle = document.getElementById('toggle-menu');  // ch·ªâ n√∫t m√†u v√†ng
        let isDragging = false, offsetX = 0, offsetY = 0;

        dragHandle.addEventListener('mousedown', function (e) {
            isDragging = true;
            offsetX = e.clientX - menu.offsetLeft;
            offsetY = e.clientY - menu.offsetTop;
            e.preventDefault();  // tr√°nh b·ªã ch·ªçn text
        });

        document.addEventListener('mousemove', function (e) {
            if (isDragging) {
                menu.style.left = (e.clientX - offsetX) + 'px';
                menu.style.top = (e.clientY - offsetY) + 'px';
            }
        });

        document.addEventListener('mouseup', function () {
            isDragging = false;
        });
    })();

    // nhap va chuyen huong
    function nhapVaChuyenHuong(actionUrl, actionName) {
        const soHoSo = prompt(`Nh·∫≠p s·ªë h·ªì s∆° ƒë·ªÉ ${actionName}:`);
        if (soHoSo) {
            window.location.href = `${actionUrl}?so_ho_so=${soHoSo}`;
        }
    }

    // search
    document.getElementById('search-toggle').addEventListener('click', function () {
        const options = document.getElementById('search-options');
        options.classList.toggle('d-none');
    });

    function submitSearch() {
        const field = document.getElementById('search-field').value;
        const value = document.getElementById('search-value').value;
        if (!field || !value) {
            alert('Vui l√≤ng ch·ªçn tr∆∞·ªùng v√† nh·∫≠p gi√° tr·ªã c·∫ßn t√¨m!');
            return;
        }
        // ƒêi·ªÅu ch·ªânh ƒë√∫ng ƒë∆∞·ªùng d·∫´n search
        const url = `/search/?search_field=${encodeURIComponent(field)}&search_value=${encodeURIComponent(value)}`;
        window.location.href = url;
    }
</script>

</body>
</html>
